pipeline {
    agent any
    
    // Remove automatic triggers to prevent unwanted builds
    // triggers {
    //    pollSCM('H/5 * * * *')
    // }

    options {
        buildDiscarder(logRotator(numToKeepStr: '5'))
    }

    stages {
        stage('Validate Tag') {
            steps {
                script {
                    // Get the GIT_BRANCH environment variable which includes the tag
                    def gitRef = env.GIT_BRANCH ?: ""
                    echo "Git Ref: ${gitRef}"
                    
                    // Check if it's a tag and specifically a develop-* tag
                    if (!gitRef.startsWith('origin/tags/develop-') && !gitRef.startsWith('refs/tags/develop-')) {
                        currentBuild.result = 'ABORTED'
                        error "This pipeline only runs for 'develop-*' tags. Aborting build. (Found ref: ${gitRef})"
                    }
                    
                    // Extract just the tag name from the full ref
                    def tagName = gitRef.replaceAll('origin/tags/develop-', 'develop-')
                                       .replaceAll('refs/tags/develop-', 'develop-')
                    
                    // Store tag name for later use
                    env.GIT_TAG = tagName
                    echo "Running for tag: ${env.GIT_TAG}"
                }
            }
        }

        stage('Info') {
            steps {
                echo "Estamos construyendo el tag: ${env.GIT_TAG}"
            }
        }

        stage('Deploy') {
            steps {
                script {
                    echo "Desplegando un tag de desarrollo: ${env.GIT_TAG}"
                    // Aqu√≠ pones tus pasos para 'develop-'
                }
            }
        }
    }

    post {
        aborted {
            echo "Build aborted: This pipeline only runs for 'develop-*' tags."
        }
        failure {
            echo "Build failed! Check the logs for more information."
        }
        success {
            echo "Build completed successfully!"
        }
    }
}