pipeline {
    agent any

    environment {
        BRANCH_TAG = "${env.GIT_TAG_NAME ?: ''}"
    }

    stages {
        stage('Preparar') {
            steps {
                script {
                    echo "Tag detectado: ${env.GIT_TAG_NAME}"
                    if (!env.GIT_TAG_NAME?.startsWith("develop-")) {
                        echo "Este pipeline solo corre para tags que empiezan con develop-"
                        currentBuild.result = 'NOT_BUILT'
                        error("Tag no permitido. Saliendo del pipeline.")
                    }
                }
            }
        }

        stage('Clonar código') {
            steps {
                checkout scm
            }
        }

        stage('Build') {
            steps {
                echo "Aquí va el proceso de build para el tag ${env.GIT_TAG_NAME}"
                // Ej: sh 'docker build ...' o lo que uses
            }
        }

        stage('Deploy') {
            steps {
                echo "Desplegando en entorno de desarrollo..."
                // Aquí pones tu lógica de despliegue (Kubernetes, Docker, SSH, etc)
            }
        }
    }
}
