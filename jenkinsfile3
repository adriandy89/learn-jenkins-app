pipeline {
    agent any

    environment {
        IS_TAG = sh(script: "git describe --exact-match --tags HEAD || echo ''", returnStdout: true).trim()
    }

    stages {
        stage('Validar tag') {
            steps {
                script {
                    if (env.IS_TAG == '') {
                        echo "No es un tag, omitiendo ejecución"
                        currentBuild.result = 'NOT_BUILT'
                        error("Este commit no es un tag.")
                    }

                    if (!env.IS_TAG.startsWith('develop-')) {
                        echo "El tag '${env.IS_TAG}' no empieza con develop-"
                        currentBuild.result = 'NOT_BUILT'
                        error("No es un tag válido para deploy")
                    }

                    echo "Tag válido: ${env.IS_TAG}"
                }
            }
        }

        stage('Build') {
            steps {
                echo "Build con tag ${env.IS_TAG}"
                // Tu lógica de build aquí
            }
        }

        stage('Deploy') {
            steps {
                echo "Desplegando para tag ${env.IS_TAG}"
                // Tu despliegue aquí
            }
        }
    }
}
